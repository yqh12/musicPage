/* empty css             *//* empty css                  */import{u as I,m as M,a as _,_ as x,o as f,c as y,b as o,n as v,d,e as c,w as g,f as b,F as A,E as R,g as E,h as L,r as P,i as B,p as S,j as $,t as m,k,l as C}from"./index-Bkx7UXcU.js";class p{constructor(){this.handlers=[]}push(t){this.handlers.push(t)}emit(){this.handlers.forEach(t=>{t()})}}class D{constructor(){this.audioCtx=new AudioContext,this.analyser=this.audioCtx.createAnalyser(),this.analyser.fftSize=128,this.utfArray=new Uint8Array(this.analyser.frequencyBinCount),this.tempArr=[],this.rectMargin=0,this.rectWidth=0,this.heightRate=0,this.playList=[],this.playIndex=0,this.emptyNode={file:null,start:null,offset:0,source:null,buffer:null},this.onPlay=new p,this.onPause=new p,this.onReady=new p,this.onChange=new p}amendData(t,i){this.rectMargin=Math.floor(t/this.analyser.frequencyBinCount)+1,this.rectWidth=this.rectMargin-1,this.heightRate=Math.floor(i/256*100)/100}drawCanvas(t,i,l){this.analyser.getByteFrequencyData(this.utfArray),l?(this.tempArr=this.utfArray,this.utfArray.forEach((r,s)=>{i.fillRect(10+s*this.rectMargin,t-r*this.heightRate,this.rectWidth,r*this.heightRate)})):this.tempArr.forEach((r,s)=>{r-- >0&&(i.fillRect(10+s*this.rectMargin,t-r*this.heightRate,this.rectWidth,r*this.heightRate),this.tempArr[s]=r)})}async getBuffer(t){return new Promise((i,l)=>{let r=new FileReader;r.onload=s=>{this.audioCtx.decodeAudioData(s.target.result).then(h=>{i(h)})},r.onerror=l,r.readAsArrayBuffer(t)})}async append(t){const i=this.isEmpty;this.playList.push({file:t,offset:0,start:null,source:null,buffer:await this.getBuffer(t)}),i&&this.onReady.emit()}play(){if(!this.playList.length||this.current.source)return;let t=this.audioCtx.createBufferSource();t.buffer=this.current.buffer,t.onended=()=>{this.next()},t.connect(this.analyser),this.analyser.connect(this.audioCtx.destination),t.start(0,this.current.offset),this.current.source=t,this.current.start=this.audioCtx.currentTime,this.onPlay.emit()}pause(){!this.playList.length||!this.current.source||(this.current.source.stop(0),this.current.source.disconnect(),this.current.source.onended=null,this.current.source=null,this.current.offset=this.position,this.current.start=null,this.onPause.emit())}stop(){this.pause(),this.current.offset=0}prev(){this.stop(),--this.playIndex,this.playIndex<0&&(this.playIndex=this.playList.length-1),this.play(),this.playList.length>1&&this.onChange.emit()}next(){this.stop(),++this.playIndex,this.playIndex>=this.playList.length&&(this.playIndex=0),this.play(),this.playList.length>1&&this.onChange.emit()}get isEmpty(){return this.current===this.emptyNode}get name(){return this.current.file.name}get current(){return this.playList[this.playIndex]||this.emptyNode}get duration(){return this.current.buffer?this.current.buffer.duration:.001}get position(){return this.playList.length?this.current.offset+(this.current.start!=null?this.audioCtx.currentTime-this.current.start:0):0}get getplayIndex(){return this.playIndex}set position(t){if(!this.playList.length)return;let i=t*this.duration;this.pause(),this.current.offset=i,this.play()}}const a=new D;I();const N={mounted(){a.onPlay.push(()=>{this.togglePlay(!0)}),a.onPause.push(()=>{this.togglePlay(!1)}),a.onChange.push(()=>{this.changeCover()}),a.onReady.push(()=>{this.changeCover()})},data(){return{stopMatrix:"",timeoutId:null,filename:[],index2:-1}},methods:{...M(["togglePlay","changeCover","toggleIsBool"]),async handleChange(){const t=this.$refs.file.files||[];if(t.length)for(let i=0;i<t.length;++i)await a.append(t[i]),this.filename.push({name:t[i].name})},musicLoad(e){console.log(e)},handleMouseEnter(){this.timeoutId&&clearTimeout(this.timeoutId),this.$store.commit("toggleIsBool",!0)},beforeDestroy(){this.timeoutId&&clearTimeout(this.timeoutId)},handleMouseLeave(){this.timeoutId=setTimeout(()=>{this.$store.commit("toggleIsBool",!1)},1e3)},login(){this.$router.push({path:"./index"})},updateAndDisplayPlayIndex(){console.log("当前播放索引:",this.playerInstance.getplayIndex)}},computed:{..._(["isPlaying","coverUrl","isbool"]),additionalButtonClass(){return this.isPlaying||this.isbool?"is-rotated":""}},watch:{isbool(e){if(!e)this.stopMatrix=getComputedStyle(this.$refs.cover).transform;else if(this.stopMatrix!=""){const t=this.stopMatrix;this.stopMatrix="";const i=t.match(/^matrix\(([^,]+),([^,]+)/);let l=Math.atan2(i[2],i[1])/Math.PI*180%360;[...document.styleSheets].forEach(s=>{try{[...s.cssRules].forEach(n=>{n.type===n.KEYFRAMES_RULE&&n.name.indexOf("rotateAnima")!=-1&&(n.cssRules[0].style.transform=`rotate(${l}deg)`,n.cssRules[1].style.transform=`rotate(${l+360}deg)`)})}catch{}})}},isPlaying(e){if(!e)this.stopMatrix=getComputedStyle(this.$refs.cover).transform;else if(this.stopMatrix!=""){const t=this.stopMatrix;this.stopMatrix="";const i=t.match(/^matrix\(([^,]+),([^,]+)/);let l=Math.atan2(i[2],i[1])/Math.PI*180%360;[...document.styleSheets].forEach(s=>{try{[...s.cssRules].forEach(n=>{n.type===n.KEYFRAMES_RULE&&n.name.indexOf("rotateAnima")!=-1&&(n.cssRules[0].style.transform=`rotate(${l}deg)`,n.cssRules[1].style.transform=`rotate(${l+360}deg)`)})}catch{}})}}}};function T(e,t,i,l,r,s){const h=R;return f(),y(A,null,[o("div",{class:d(["disk",{disk__playing:e.isPlaying||e.isbool}]),onMouseleave:t[1]||(t[1]=(...n)=>s.handleMouseLeave&&s.handleMouseLeave(...n)),onMouseenter:t[2]||(t[2]=(...n)=>s.handleMouseEnter&&s.handleMouseEnter(...n))},[o("label",{for:"file",class:"disk_cover",ref:"cover",style:v({transform:r.stopMatrix,backgroundImage:e.coverUrl?`url(${e.coverUrl})`:""})},null,4),o("input",{id:"file",type:"file",ref:"file",accept:"music/mp3",multiple:"",onChange:t[0]||(t[0]=(...n)=>s.handleChange&&s.handleChange(...n))},null,544)],34),c(h,{onClick:s.login,class:d(["button",{button_two:e.isPlaying||e.isbool}])},{default:g(()=>[b("进入博客")]),_:1},8,["onClick","class"])],64)}const F=x(N,[["render",T]]),U={components:{DArrowRight:E,DArrowLeft:L},computed:{..._(["isPlaying"])},methods:{...M(["togglePlay"]),handlePrev(){this.isPlaying&&a.prev()},handlePlay(){a.isEmpty?alert("请加入音乐"):this.isPlaying?a.pause():a.play()},handleNext(){this.isPlaying&&a.next()}}},q=e=>(S("data-v-e1ae87f5"),e=e(),$(),e),W=q(()=>o("span",{class:"play-btn"},null,-1)),z=[W];function V(e,t,i,l,r,s){const h=P("DArrowLeft"),n=B,w=P("DArrowRight");return f(),y("div",{class:d(["control",{control__playing:e.isPlaying}])},[o("div",{class:"control_btn control_btn__side",onClick:t[0]||(t[0]=(...u)=>s.handlePrev&&s.handlePrev(...u))},[c(n,null,{default:g(()=>[c(h)]),_:1})]),o("div",{class:"control_btn",onClick:t[1]||(t[1]=(...u)=>s.handlePlay&&s.handlePlay(...u))},z),o("div",{class:"control_btn control_btn__side",onClick:t[2]||(t[2]=(...u)=>s.handleNext&&s.handleNext(...u))},[c(n,null,{default:g(()=>[c(w)]),_:1})])],2)}const K=x(U,[["render",V],["__scopeId","data-v-e1ae87f5"]]),O={methods:{setPos(e){let t=parseFloat(getComputedStyle(this.$refs.line).width),i=e.offsetX/t;a.position=i},formatName(e){return e.replace(/\.(mp3|flac)$/,"")},formatTime(e){const t=Math.floor(e/60),i=Math.floor(e%60);return`${t}:${i<10?"0":""}${i}`}},mounted(){const e=()=>{window.requestAnimationFrame(e);const t=a.position/a.duration;this.progress=`${(t*100).toFixed(2)}%`,this.position=a.position,this.duration=a.duration,this.name=a.current.file?a.current.file.name:""};e()},data(){return{name:"",position:0,duration:.001,progress:""}},computed:{..._(["isPlaying"])}},Y={class:"progress_title"},j={class:"progress_text"},X=o("p",{class:"progress_in"},"欢迎来到1TB的博客",-1);function G(e,t,i,l,r,s){return f(),y("div",{class:d(["progress",{progress__playing:e.isPlaying}])},[o("h2",Y,m(s.formatName(r.name)),1),o("p",j,m(s.formatTime(r.position))+"/ "+m(s.formatTime(r.duration)),1),o("div",{class:"progress_line",onClick:t[0]||(t[0]=(...h)=>s.setPos&&s.setPos(...h)),ref:"line"},[o("span",{style:v({width:r.progress})},null,4)],512),X],2)}const H=x(O,[["render",G]]),J={class:"login"},Q={class:"player_disk"},Z={class:"player_control",style:{position:"absolute"}},tt={class:"player_progress",style:{position:"absolute"}},rt={__name:"index",setup(e){const t=k();return(i,l)=>(f(),y("div",J,[o("div",Q,[c(F),o("div",{id:"player",class:d(["player",{player_two:C(t).state.isPlaying||C(t).state.isbool}])},[o("div",Z,[c(K)]),o("div",tt,[c(H)])],2)])]))}};export{rt as default};
